┌─────────────────────────────────────────────────────────────────────────────────┐
│                          SAPPHIRE TRADING SYSTEM                               │
│                          ====================                                  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │                        FRONTEND LAYER                                  │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │  │
│  │  │   Trading       │  │   Portfolio     │  │ Infrastructure  │        │  │
│  │  │   Dashboard     │  │   Matrix        │  │   Topology      │        │  │
│  │  │   (React/Vite)  │  │   (Real-time)   │  │   (Visual)       │        │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │  │
│  │               │                        │                        │        │  │
│  └───────────────┼────────────────────────┼────────────────────────┘        │
│                  │                        │                        │        │
│  ┌───────────────┼────────────────────────┼────────────────────────┐        │
│  │               ▼                        ▼                        ▼        │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                    BACKEND API LAYER                          │   │  │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │   │  │
│  │  │  │   FastAPI       │  │   WebSocket     │  │   REST API      │  │   │  │
│  │  │  │   Server        │  │   Manager       │  │   Endpoints     │  │   │  │
│  │  │  │   (uvicorn)     │  │   (Real-time)   │  │   (/api/*)       │  │   │  │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  │   │  │
│  │  │               │                        │                        │  │   │  │
│  │  └───────────────┼────────────────────────┼────────────────────────┘   │  │
│  │                  │                        │                        │   │  │
│  │  ┌───────────────┼────────────────────────┼────────────────────────┐   │  │
│  │  │               ▼                        ▼                        ▼   │  │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │  │                TRADING SERVICE LAYER                         │ │ │  │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │ │  │
│  │  │  │  │ TradingService  │  │ Agent           │  │ Position        │ │ │ │  │
│  │  │  │  │ (Main Engine)   │  │ Coordinator     │  │ Sizing          │ │ │ │  │
│  │  │  │  │ ⚠️ NOT WORKING  │  │ (MCP Protocol)  │  │ (Risk Mgmt)     │ │ │ │  │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │ │  │
│  │  │  │               │                        │                        │ │ │  │
│  │  │  └───────────────┼────────────────────────┼────────────────────────┘ │ │  │
│  │  │                  │                        │                        │ │ │  │
│  │  │  ┌───────────────┼────────────────────────┼────────────────────────┐ │ │  │
│  │  │  │               ▼                        ▼                        ▼ │ │ │  │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────┐ │ │ │  │
│  │  │  │  │                    AI AGENT LAYER                            │ │ │ │  │
│  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │ │ │  │
│  │  │  │  │  │ Trend Momentum  │  │ Strategy Opt.   │  │ Financial Sent. │ │ │ │ │  │
│  │  │  │  │  │ Agent ($500)    │  │ Agent ($500)     │  │ Agent ($500)    │ │ │ │ │  │
│  │  │  │  │  │                 │  │                  │  │                 │ │ │ │ │  │
│  │  │  │  │  │ Market Pred.    │  │ Volume Micro.    │  │ VPIN HFT        │ │ │ │ │  │
│  │  │  │  │  │ Agent ($500)    │  │ Agent ($500)     │  │ Agent ($500)    │ │ │ │ │  │
│  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │ │ │  │
│  │  │  │                    │                        │                    │ │ │ │  │
│  │  │  │  └────────────────────┼────────────────────────┼────────────────────┘ │ │ │  │
│  │  │  │                       │                        │                      │ │ │  │
│  │  │  ┌───────────────────────┼────────────────────────┼──────────────────────┐ │ │  │
│  │  │  │                       ▼                        ▼                      │ │ │  │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │ │ │  │
│  │  │  │  │                EXTERNAL INTEGRATIONS                         │   │ │ │ │  │
│  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │ │ │ │  │
│  │  │  │  │  │   Aster DEX     │  │   Telegram Bot   │  │   Gemini AI     │   │   │ │ │ │  │
│  │  │  │  │  │   (Live Trading)│  │   (Alerts)       │  │   (LLM)         │   │   │ │ │ │  │
│  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │ │ │ │  │
│  │  │  │  │               │                        │                        │   │ │ │ │  │
│  │  │  └───────────────┼────────────────────────┼────────────────────────┘   │   │ │ │  │
│  │  │                  │                        │                        │   │   │ │  │
│  │  ┌─────────────────┼────────────────────────┼────────────────────────┼──┐ │ │ │  │
│  │  │                 ▼                        ▼                        ▼  │ │ │  │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐  │ │ │  │
│  │  │  │                   DATA & STORAGE LAYER                        │  │ │ │  │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │  │ │ │  │
│  │  │  │  │   PostgreSQL    │  │   Redis Cache    │  │   TimescaleDB   │  │  │ │ │  │
│  │  │  │  │   (Trading DB)  │  │   (Market Data)  │  │   (Time Series) │  │  │ │ │  │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  │  │ │ │  │
│  │  │  │               │                        │                        │  │ │ │  │
│  │  │  └───────────────┼────────────────────────┼────────────────────────┘  │ │ │  │
│  │  │                  │                        │                        │  │ │ │  │
│  │  └─────────────────┼────────────────────────┼────────────────────────┼──┘ │ │  │
│  │                    │                        │                        │    │ │  │
│  └────────────────────┼────────────────────────┼────────────────────────┼────┘ │  │
│                       │                        │                        │      │  │
│  ┌────────────────────┼────────────────────────┼────────────────────────┼──────┐ │  │
│  │                    ▼                        ▼                        ▼      │ │  │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │                       INFRASTRUCTURE LAYER                          │ │ │  │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │ │ │  │
│  │  │  │   Google Cloud  │  │   Kubernetes    │  │   GKE Cluster    │        │ │ │  │
│  │  │  │   Platform      │  │   (GKE)         │  │   (Production)   │        │ │ │  │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │ │ │  │
│  │  │               │                        │                        │        │ │ │  │
│  │  └───────────────┼────────────────────────┼────────────────────────┘        │ │  │
│  │                  │                        │                        │        │ │  │
│  └─────────────────┼────────────────────────┼────────────────────────┼────────┘ │  │
│                    │                        │                        │          │  │
│  ┌─────────────────┼────────────────────────┼────────────────────────┼──────────┐ │  │
│  │                 ▼                        ▼                        ▼          │ │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │                     DEVELOPMENT & MONITORING                          │ │ │  │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │ │ │  │
│  │  │  │   Cloud Build   │  │   Container     │  │   Logging &      │          │ │ │  │
│  │  │  │   (CI/CD)       │  │   Registry      │  │   Monitoring     │          │ │ │  │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘          │ │ │  │
│  │  └─────────────────────────────────────────────────────────────────────────┘ │ │  │
│  └──────────────────────────────────────────────────────────────────────────────┘ │  │
└──────────────────────────────────────────────────────────────────────────────────┘  │
                                                                                     │
┌─────────────────────────────────────────────────────────────────────────────────────┐ │
│                               CURRENT BLOCKER                                     │ │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  ❌ TradingService Initialization Failure                               │   │ │
│  │                                                                         │   │ │
│  │  Problem: uvicorn factory mode not executing build_app() initialization │   │ │
│  │  Impact: 6 AI agents ($3000 capital) cannot start live trading         │   │ │
│  │  Status: Service runs but agents = 0                                   │   │ │
│  └─────────────────────────────────────────────────────────────────────────┘   │ │
└─────────────────────────────────────────────────────────────────────────────────┘ │
                                                                                   │
┌───────────────────────────────────────────────────────────────────────────────────┐ │
│                            NEXT STEPS PLAN                                       │ │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  1. Switch from uvicorn --factory to direct app import                    │   │ │
│  │  2. Create module-level app instance instead of factory function          │   │ │
│  │  3. Test TradingService initialization with direct app import             │   │ │
│  │  4. Verify all 6 agents load and start live trading with $500 each       │   │ │
│  │  5. Confirm Telegram alerts working for all trading activity             │   │ │
│  └─────────────────────────────────────────────────────────────────────────┘   │ │
└───────────────────────────────────────────────────────────────────────────────────┘ │
                                                                                     │
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                               SUCCESS CRITERIA                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │  ✅ /api/agents returns 6 agents (total_enabled: 6, available: 6)          │   │
│  │  ✅ /dashboard shows active trading signals and portfolio updates          │   │
│  │  ✅ Telegram bot receives real-time trade alerts                          │   │
│  │  ✅ Frontend displays live trading data and agent communications          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────────────────┘
